"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _lodash = _interopRequireDefault(require("lodash"));

var _constants = require("../../../lib/constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @prettier

 */
function _default(route, storage) {
  route.get('/-/_view/starredByUser', (req, res, next) => {
    const remoteUsername = req.remote_user.name;
    storage.getLocalDatabase((err, localPackages) => {
      if (err) {
        return next(err);
      }

      const filteredPackages = localPackages.filter(localPackage => _lodash.default.keys(localPackage[_constants.USERS]).includes(remoteUsername));
      res.status(_constants.HTTP_STATUS.OK);
      next({
        rows: filteredPackages.map(filteredPackage => ({
          value: filteredPackage.name
        }))
      });
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcGkvZW5kcG9pbnQvYXBpL3N0YXJzLnRzIl0sIm5hbWVzIjpbInJvdXRlIiwic3RvcmFnZSIsImdldCIsInJlcSIsInJlcyIsIm5leHQiLCJyZW1vdGVVc2VybmFtZSIsInJlbW90ZV91c2VyIiwibmFtZSIsImdldExvY2FsRGF0YWJhc2UiLCJlcnIiLCJsb2NhbFBhY2thZ2VzIiwiZmlsdGVyZWRQYWNrYWdlcyIsImZpbHRlciIsImxvY2FsUGFja2FnZSIsIl8iLCJrZXlzIiwiVVNFUlMiLCJpbmNsdWRlcyIsInN0YXR1cyIsIkhUVFBfU1RBVFVTIiwiT0siLCJyb3dzIiwibWFwIiwiZmlsdGVyZWRQYWNrYWdlIiwidmFsdWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFLQTs7QUFLQTs7OztBQVZBO0FBQ0E7QUFDQTtBQUNBO0FBV2Usa0JBQVVBLEtBQVYsRUFBeUJDLE9BQXpCLEVBQXlEO0FBQ3RFRCxFQUFBQSxLQUFLLENBQUNFLEdBQU4sQ0FBVSx3QkFBVixFQUFvQyxDQUFDQyxHQUFELEVBQXNCQyxHQUF0QixFQUFxQ0MsSUFBckMsS0FBc0U7QUFDeEcsVUFBTUMsY0FBYyxHQUFHSCxHQUFHLENBQUNJLFdBQUosQ0FBZ0JDLElBQXZDO0FBRUFQLElBQUFBLE9BQU8sQ0FBQ1EsZ0JBQVIsQ0FBeUIsQ0FBQ0MsR0FBRCxFQUFNQyxhQUFOLEtBQWtDO0FBQ3pELFVBQUlELEdBQUosRUFBUztBQUNQLGVBQU9MLElBQUksQ0FBQ0ssR0FBRCxDQUFYO0FBQ0Q7O0FBRUQsWUFBTUUsZ0JBQTBCLEdBQUdELGFBQWEsQ0FBQ0UsTUFBZCxDQUFzQkMsWUFBRCxJQUEyQkMsZ0JBQUVDLElBQUYsQ0FBT0YsWUFBWSxDQUFDRyxnQkFBRCxDQUFuQixFQUE0QkMsUUFBNUIsQ0FBcUNaLGNBQXJDLENBQWhELENBQW5DO0FBRUFGLE1BQUFBLEdBQUcsQ0FBQ2UsTUFBSixDQUFXQyx1QkFBWUMsRUFBdkI7QUFDQWhCLE1BQUFBLElBQUksQ0FBQztBQUNIaUIsUUFBQUEsSUFBSSxFQUFFVixnQkFBZ0IsQ0FBQ1csR0FBakIsQ0FBc0JDLGVBQUQsS0FBK0I7QUFDeERDLFVBQUFBLEtBQUssRUFBRUQsZUFBZSxDQUFDaEI7QUFEaUMsU0FBL0IsQ0FBckI7QUFESCxPQUFELENBQUo7QUFLRCxLQWJEO0FBY0QsR0FqQkQ7QUFrQkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBwcmV0dGllclxuXG4gKi9cbmltcG9ydCB7IFJlc3BvbnNlLCBSb3V0ZXIgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IFBhY2thZ2UgfSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcblxuaW1wb3J0IHsgJE5leHRGdW5jdGlvblZlciwgJFJlcXVlc3RFeHRlbmQsIElTdG9yYWdlSGFuZGxlciB9IGZyb20gJy4uLy4uLy4uLy4uL3R5cGVzJztcbmltcG9ydCB7IEhUVFBfU1RBVFVTLCBVU0VSUyB9IGZyb20gJy4uLy4uLy4uL2xpYi9jb25zdGFudHMnO1xuXG50eXBlIFBhY2thZ2VzID0gUGFja2FnZVtdO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAocm91dGU6IFJvdXRlciwgc3RvcmFnZTogSVN0b3JhZ2VIYW5kbGVyKTogdm9pZCB7XG4gIHJvdXRlLmdldCgnLy0vX3ZpZXcvc3RhcnJlZEJ5VXNlcicsIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6IFJlc3BvbnNlLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCA9PiB7XG4gICAgY29uc3QgcmVtb3RlVXNlcm5hbWUgPSByZXEucmVtb3RlX3VzZXIubmFtZTtcblxuICAgIHN0b3JhZ2UuZ2V0TG9jYWxEYXRhYmFzZSgoZXJyLCBsb2NhbFBhY2thZ2VzOiBQYWNrYWdlcykgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZXR1cm4gbmV4dChlcnIpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmaWx0ZXJlZFBhY2thZ2VzOiBQYWNrYWdlcyA9IGxvY2FsUGFja2FnZXMuZmlsdGVyKChsb2NhbFBhY2thZ2U6IFBhY2thZ2UpID0+IF8ua2V5cyhsb2NhbFBhY2thZ2VbVVNFUlNdKS5pbmNsdWRlcyhyZW1vdGVVc2VybmFtZSkpO1xuXG4gICAgICByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk9LKTtcbiAgICAgIG5leHQoe1xuICAgICAgICByb3dzOiBmaWx0ZXJlZFBhY2thZ2VzLm1hcCgoZmlsdGVyZWRQYWNrYWdlOiBQYWNrYWdlKSA9PiAoe1xuICAgICAgICAgIHZhbHVlOiBmaWx0ZXJlZFBhY2thZ2UubmFtZSxcbiAgICAgICAgfSkpLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufVxuIl19